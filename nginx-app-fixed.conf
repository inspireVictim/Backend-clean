server {
    listen 443 ssl;
    http2 on;
    server_name app.yessgo.org;

    ssl_certificate /etc/letsencrypt/live/yessgo.org/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/yessgo.org/privkey.pem;

    root /var/www/web-version-YES-GO/dist;
    index index.html;

    # ========== ВАЖНО: ПРАВИЛЬНЫЕ LOCATION БЛОКИ ==========
    
    # 1. Иконы и изображения
    location /icons/ {
        try_files $uri =404;
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
    
    # 2. JavaScript файлы
    location ~* \.(js|mjs)$ {
        try_files $uri =404;
        add_header Content-Type application/javascript;
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
    
    # 3. CSS файлы
    location ~* \.css$ {
        try_files $uri =404;
        add_header Content-Type text/css;
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
    
    # 4. Изображения
    location ~* \.(png|jpg|jpeg|gif|ico|svg|webp)$ {
        try_files $uri =404;
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
    
    # 5. Шрифты
    location ~* \.(woff|woff2|ttf|eot)$ {
        try_files $uri =404;
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
    
    # 6. Главное правило для SPA (ДОЛЖНО БЫТЬ ПОСЛЕДНИМ!)
    location / {
        try_files $uri $uri/ /index.html;
        add_header Cache-Control "no-store, no-cache, must-revalidate";
    }
    
    # Запрещаем доступ к скрытым файлам
    location ~ /\. {
        deny all;
        return 404;
    }
}
